"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var path = require("path");
var util = require("util");
// Old version used to use 'unknown'.  Removing this 
//  as we don't want to write this to the actual file.
//  using null instead.
// export type XC_FILETYPE = 'unknown' | XC_FILETYPE_KNOWN;
// const DEFAULT_FILETYPE: XC_FILETYPE = 'unknown';
var FILETYPE_BY_EXTENSION = {
    a: 'archive.ar',
    app: 'wrapper.application',
    appex: 'wrapper.app-extension',
    bundle: 'wrapper.plug-in',
    dylib: 'compiled.mach-o.dylib',
    framework: 'wrapper.framework',
    h: 'sourcecode.c.h',
    m: 'sourcecode.c.objc',
    markdown: 'text',
    mdimporter: 'wrapper.cfbundle',
    octest: 'wrapper.cfbundle',
    pch: 'sourcecode.c.h',
    plist: 'text.plist.xml',
    sh: 'text.script.sh',
    swift: 'sourcecode.swift',
    tbd: 'sourcecode.text-based-dylib-definition',
    xcassets: 'folder.assetcatalog',
    xcconfig: 'text.xcconfig',
    xcdatamodel: 'wrapper.xcdatamodel',
    xcodeproj: 'wrapper.pb-project',
    xctest: 'wrapper.cfbundle',
    xib: 'file.xib',
    strings: 'text.plist.strings'
};
function unquoted(text) {
    return typeof text != 'string' ? '' : text.replace(/(^")|("$)/g, '');
}
/**
 *
 * @param filePath
 * @returns undefined if unknown extension.
 */
function detectType(filePath) {
    var extension = path.extname(filePath).substring(1);
    var filetype = FILETYPE_BY_EXTENSION[unquoted(extension)];
    if (filetype == undefined) {
        return 'unknown';
    }
    else {
        return filetype;
    }
}
function defaultExtension(fileRef) {
    var filetype = (fileRef.lastKnownFileType && fileRef.lastKnownFileType != 'unknown') ? fileRef.lastKnownFileType : fileRef.explicitFileType;
    // Had removed the use of 'unknown'.  However, found that tests were demanding it.  Put back
    //  in for compatibility with existing clients. 
    //    var filetype = fileRef.lastKnownFileType && fileRef.lastKnownFileType != DEFAULT_FILETYPE ?
    //    fileRef.lastKnownFileType : fileRef.explicitFileType;
    for (var extension in FILETYPE_BY_EXTENSION) {
        if (FILETYPE_BY_EXTENSION.hasOwnProperty(unquoted(extension))) {
            if (FILETYPE_BY_EXTENSION[unquoted(extension)] === unquoted(filetype))
                return extension;
        }
    }
    return undefined;
}
//const DEFAULT_FILEENCODING: XC_ENCODING_TYPE = 4; // unused?
var ENCODING_BY_FILETYPE = {
    'sourcecode.c.h': 4,
    // 'sourcecode.c.h': 4,  duplicate key removed
    'sourcecode.c.objc': 4,
    'sourcecode.swift': 4,
    'text': 4,
    'text.plist.xml': 4,
    'text.script.sh': 4,
    'text.xcconfig': 4,
    'text.plist.strings': 4
};
/**
 * @param fileRef
 */
function defaultEncoding(fileRef) {
    var filetype = fileRef.lastKnownFileType || fileRef.explicitFileType;
    var encoding = ENCODING_BY_FILETYPE[unquoted(filetype)];
    if (encoding) {
        return encoding;
    }
    else {
        return undefined;
    }
}
var DEFAULT_GROUP = 'Resources';
var GROUP_BY_FILETYPE = {
    'archive.ar': 'Frameworks',
    'compiled.mach-o.dylib': 'Frameworks',
    'sourcecode.text-based-dylib-definition': 'Frameworks',
    'wrapper.framework': 'Frameworks',
    'embedded.framework': 'Embed Frameworks',
    'sourcecode.c.h': 'Resources',
    'sourcecode.c.objc': 'Sources',
    'sourcecode.swift': 'Sources'
};
function detectGroup(fileRef, opt) {
    if (opt.customFramework && opt.embed) {
        return GROUP_BY_FILETYPE['embedded.framework'];
    }
    var extension = path.extname(fileRef.basename).substring(1);
    if (extension === 'xcdatamodeld') {
        return 'Sources';
    }
    var filetype = fileRef.lastKnownFileType || fileRef.explicitFileType;
    var groupName = GROUP_BY_FILETYPE[unquoted(filetype)];
    return groupName ? groupName : DEFAULT_GROUP;
}
var SOURCETREE_BY_FILETYPE = {
    'compiled.mach-o.dylib': 'SDKROOT',
    'sourcecode.text-based-dylib-definition': 'SDKROOT',
    'wrapper.framework': 'SDKROOT'
};
var DEFAULT_SOURCETREE = '"<group>"';
var DEFAULT_PRODUCT_SOURCETREE = 'BUILT_PRODUCTS_DIR';
function detectSourcetree(fileRef) {
    var filetype = fileRef.lastKnownFileType || fileRef.explicitFileType, sourcetree = SOURCETREE_BY_FILETYPE[unquoted(filetype)];
    if (fileRef.explicitFileType) {
        return DEFAULT_PRODUCT_SOURCETREE;
    }
    if (fileRef.customFramework) {
        return DEFAULT_SOURCETREE;
    }
    if (!sourcetree) {
        return DEFAULT_SOURCETREE;
    }
    return sourcetree;
}
var PATH_BY_FILETYPE = {
    'compiled.mach-o.dylib': 'usr/lib/',
    'sourcecode.text-based-dylib-definition': 'usr/lib/',
    'wrapper.framework': 'System/Library/Frameworks/'
};
function defaultPath(fileRef, filePath) {
    if (fileRef.customFramework) {
        return filePath;
    }
    var filetype = fileRef.lastKnownFileType || fileRef.explicitFileType;
    var defaultPath = PATH_BY_FILETYPE[unquoted(filetype)];
    if (defaultPath) {
        return path.join(defaultPath, path.basename(filePath));
    }
    return filePath;
}
/** In memory instance for interacting with a conceptual PbxFile.
 * This is not part of the in memory model of the file contents.
 * This is turned into a PBXFileReference by the non exposed function
 * pbxFileReferenceObj used by the methods addToPbxFileReferenceSection and
 * removeFromPbxFileRefereneSection.
  */
var PbxFile = /** @class */ (function () {
    function PbxFile(filepath, opt) {
        var efOpt = opt || {};
        this.basename = path.basename(filepath);
        this.lastKnownFileType = efOpt.lastKnownFileType || detectType(filepath);
        this.group = detectGroup(this, efOpt);
        // for custom frameworks
        if (efOpt.customFramework == true) {
            this.customFramework = true;
            this.dirname = path.dirname(filepath).replace(/\\/g, '/');
        }
        this.path = defaultPath(this, filepath).replace(/\\/g, '/');
        this.fileEncoding = this.defaultEncoding = efOpt.defaultEncoding || defaultEncoding(this);
        // When referencing products / build output files
        if (efOpt.explicitFileType) {
            this.explicitFileType = efOpt.explicitFileType;
            this.basename = this.basename + '.' + defaultExtension(this);
            delete this.path;
            delete this.lastKnownFileType;
            delete this.group;
            delete this.defaultEncoding;
        }
        this.sourceTree = efOpt.sourceTree || detectSourcetree(this);
        this.includeInIndex = 0;
        if (efOpt.weak && efOpt.weak === true)
            this.settings = { ATTRIBUTES: ['Weak'] };
        if (efOpt.compilerFlags) {
            if (!this.settings)
                this.settings = {};
            this.settings.COMPILER_FLAGS = util.format('"%s"', efOpt.compilerFlags);
        }
        if (efOpt.embed && efOpt.sign) {
            if (!this.settings)
                this.settings = {};
            if (!this.settings.ATTRIBUTES)
                this.settings.ATTRIBUTES = [];
            this.settings.ATTRIBUTES.push('CodeSignOnCopy');
        }
    }
    return PbxFile;
}());
exports.PbxFile = PbxFile;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGJ4RmlsZURlZi5qcyIsInNvdXJjZVJvb3QiOiIuLi9zcmMvdHMvIiwic291cmNlcyI6WyJsaWIvUGJ4RmlsZURlZi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDJCQUE2QjtBQUM3QiwyQkFBNkI7QUE0QjdCLHFEQUFxRDtBQUNyRCxzREFBc0Q7QUFDdEQsdUJBQXVCO0FBQ3ZCLDJEQUEyRDtBQUMzRCxtREFBbUQ7QUFHbkQsSUFBTSxxQkFBcUIsR0FBNkM7SUFDcEUsQ0FBQyxFQUFFLFlBQVk7SUFDZixHQUFHLEVBQUUscUJBQXFCO0lBQzFCLEtBQUssRUFBRSx1QkFBdUI7SUFDOUIsTUFBTSxFQUFFLGlCQUFpQjtJQUN6QixLQUFLLEVBQUUsdUJBQXVCO0lBQzlCLFNBQVMsRUFBRSxtQkFBbUI7SUFDOUIsQ0FBQyxFQUFFLGdCQUFnQjtJQUNuQixDQUFDLEVBQUUsbUJBQW1CO0lBQ3RCLFFBQVEsRUFBRSxNQUFNO0lBQ2hCLFVBQVUsRUFBRSxrQkFBa0I7SUFDOUIsTUFBTSxFQUFFLGtCQUFrQjtJQUMxQixHQUFHLEVBQUUsZ0JBQWdCO0lBQ3JCLEtBQUssRUFBRSxnQkFBZ0I7SUFDdkIsRUFBRSxFQUFFLGdCQUFnQjtJQUNwQixLQUFLLEVBQUUsa0JBQWtCO0lBQ3pCLEdBQUcsRUFBRSx3Q0FBd0M7SUFDN0MsUUFBUSxFQUFFLHFCQUFxQjtJQUMvQixRQUFRLEVBQUUsZUFBZTtJQUN6QixXQUFXLEVBQUUscUJBQXFCO0lBQ2xDLFNBQVMsRUFBRSxvQkFBb0I7SUFDL0IsTUFBTSxFQUFFLGtCQUFrQjtJQUMxQixHQUFHLEVBQUUsVUFBVTtJQUNmLE9BQU8sRUFBRSxvQkFBb0I7Q0FDaEMsQ0FBQztBQUVGLFNBQVMsUUFBUSxDQUFDLElBQStCO0lBQzdDLE9BQU8sT0FBTyxJQUFJLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEVBQUUsQ0FBQyxDQUFB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LElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVU7Z0JBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztZQUNsQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztTQUNuRDtJQUNMLENBQUM7SUFDTCxjQUFDO0FBQUQsQ0FBQyxBQWxHRCxJQWtHQztBQWxHWSwwQkFBTyIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAndXRpbCc7XG5pbXBvcnQgeyBYQ19QUk9KX1VVSUQgfSBmcm9tICcuL0lYY29kZVByb2pGaWxlU2ltcGxlVHlwZXMnO1xuXG5leHBvcnQgdHlwZSBYQ19GSUxFVFlQRSA9XG4gICAgJ2FyY2hpdmUuYXInIHxcbiAgICAnd3JhcHBlci5hcHBsaWNhdGlvbicgfFxuICAgICd3cmFwcGVyLmFwcC1leHRlbnNpb24nIHxcbiAgICAnd3JhcHBlci5wbHVnLWluJyB8XG4gICAgJ2NvbXBpbGVkLm1hY2gtby5keWxpYicgfFxuICAgICd3cmFwcGVyLmZyYW1ld29yaycgfFxuICAgICdzb3VyY2Vjb2RlLmMuaCcgfFxuICAgICdzb3VyY2Vjb2RlLmMub2JqYycgfFxuICAgICd0ZXh0JyB8XG4gICAgJ3dyYXBwZXIuY2ZidW5kbGUnIHxcbiAgICAnd3JhcHBlci5jZmJ1bmRsZScgfFxuICAgICdzb3VyY2Vjb2RlLmMuaCcgfFxuICAgICd0ZXh0LnBsaXN0LnhtbCcgfFxuICAgICd0ZXh0LnNjcmlwdC5zaCcgfFxuICAgICdzb3VyY2Vjb2RlLnN3aWZ0JyB8XG4gICAgJ3NvdXJjZWNvZGUudGV4dC1iYXNlZC1keWxpYi1kZWZpbml0aW9uJyB8XG4gICAgJ2ZvbGRlci5hc3NldGNhdGFsb2cnIHxcbiAgICAndGV4dC54Y2NvbmZpZycgfFxuICAgICd3cmFwcGVyLnhjZGF0YW1vZGVsJyB8XG4gICAgJ3dyYXBwZXIucGItcHJvamVjdCcgfFxuICAgICd3cmFwcGVyLmNmYnVuZGxlJyB8XG4gICAgJ2ZpbGUueGliJyB8XG4gICAgJ3RleHQucGxpc3Quc3RyaW5ncyc7XG5cbi8vIE9sZCB2ZXJzaW9uIHVzZWQgdG8gdXNlICd1bmtub3duJy4gIFJlbW92aW5nIHRoaXMgXG4vLyAgYXMgd2UgZG9uJ3Qgd2FudCB0byB3cml0ZSB0aGlzIHRvIHRoZSBhY3R1YWwgZmlsZS5cbi8vICB1c2luZyBudWxsIGluc3RlYWQuXG4vLyBleHBvcnQgdHlwZSBYQ19GSUxFVFlQRSA9ICd1bmtub3duJyB8IFhDX0ZJTEVUWVBFX0tOT1dOO1xuLy8gY29uc3QgREVGQVVMVF9GSUxFVFlQRTogWENfRklMRVRZUEUgPSAndW5rbm93bic7XG5cblxuY29uc3QgRklMRVRZUEVfQllfRVhURU5TSU9OOiB7IFtmaWxlRXh0ZW5zaW9uOiBzdHJpbmddOiBYQ19GSUxFVFlQRSB9ID0ge1xuICAgIGE6ICdhcmNoaXZlLmFyJyxcbiAgICBhcHA6ICd3cmFwcGVyLmFwcGxpY2F0aW9uJyxcbiAgICBhcHBleDogJ3dyYXBwZXIuYXBwLWV4dGVuc2lvbicsXG4gICAgYnVuZGxlOiAnd3JhcHBlci5wbHVnLWluJyxcbiAgICBkeWxpYjogJ2NvbXBpbGVkLm1hY2gtby5keWxpYicsXG4gICAgZnJhbWV3b3JrOiAnd3JhcHBlci5mcmFtZXdvcmsnLFxuICAgIGg6ICdzb3VyY2Vjb2RlLmMuaCcsXG4gICAgbTogJ3NvdXJjZWNvZGUuYy5vYmpjJyxcbiAgICBtYXJrZG93bjogJ3RleHQnLFxuICAgIG1kaW1wb3J0ZXI6ICd3cmFwcGVyLmNmYnVuZGxlJyxcbiAgICBvY3Rlc3Q6ICd3cmFwcGVyLmNmYnVuZGxlJyxcbiAgICBwY2g6ICdzb3VyY2Vjb2RlLmMuaCcsXG4gICAgcGxpc3Q6ICd0ZXh0LnBsaXN0LnhtbCcsXG4gICAgc2g6ICd0ZXh0LnNjcmlwdC5zaCcsXG4gICAgc3dpZnQ6ICdzb3VyY2Vjb2RlLnN3aWZ0JyxcbiAgICB0YmQ6ICdzb3VyY2Vjb2RlLnRleHQtYmFzZWQtZHlsaWItZGVmaW5pdGlvbicsXG4gICAgeGNhc3NldHM6ICdmb2xkZXIuYXNzZXRjYXRhbG9nJyxcbiAgICB4Y2NvbmZpZzogJ3RleHQueGNjb25maWcnLFxuICAgIHhjZGF0YW1vZGVsOiAnd3JhcHBlci54Y2RhdGFtb2RlbCcsXG4gICAgeGNvZGVwcm9qOiAnd3JhcHBlci5wYi1wcm9qZWN0JyxcbiAgICB4Y3Rlc3Q6ICd3cmFwcGVyLmNmYnVuZGxlJyxcbiAgICB4aWI6ICdmaWxlLnhpYicsXG4gICAgc3RyaW5nczogJ3RleHQucGxpc3Quc3RyaW5ncydcbn07XG5cbmZ1bmN0aW9uIHVucXVvdGVkKHRleHQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpOiBzdHJpbmcge1xuICAgIHJldHVybiB0eXBlb2YgdGV4dCAhPSAnc3RyaW5nJyA/ICcnIDogdGV4dC5yZXBsYWNlKC8oXlwiKXwoXCIkKS9nLCAnJylcbn1cblxuLyoqXG4gKiBcbiAqIEBwYXJhbSBmaWxlUGF0aCBcbiAqIEByZXR1cm5zIHVuZGVmaW5lZCBpZiB1bmtub3duIGV4dGVuc2lvbi4gIFxuICovXG5mdW5jdGlvbiBkZXRlY3RUeXBlKGZpbGVQYXRoOiBzdHJpbmcpOiBYQ19GSUxFVFlQRSB8ICd1bmtub3duJyB7XG4gICAgY29uc3QgZXh0ZW5zaW9uID0gcGF0aC5leHRuYW1lKGZpbGVQYXRoKS5zdWJzdHJpbmcoMSk7XG5cbiAgICBjb25zdCBmaWxldHlwZTogWENfRklMRVRZUEUgfCB1bmRlZmluZWQgPSBGSUxFVFlQRV9CWV9FWFRFTlNJT05bdW5xdW90ZWQoZXh0ZW5zaW9uKV07XG5cbiAgICBpZiAoZmlsZXR5cGUgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiAndW5rbm93bic7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZpbGV0eXBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZGVmYXVsdEV4dGVuc2lvbihmaWxlUmVmOiBQYnhGaWxlKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcblxuICAgIGNvbnN0IGZpbGV0eXBlOiBYQ19GSUxFVFlQRSB8ICd1bmtub3duJyB8IHVuZGVmaW5lZCA9XG4gICAgICAgIChmaWxlUmVmLmxhc3RLbm93bkZpbGVUeXBlICYmIGZpbGVSZWYubGFzdEtub3duRmlsZVR5cGUgIT0gJ3Vua25vd24nKT8gZmlsZVJlZi5sYXN0S25vd25GaWxlVHlwZSA6IGZpbGVSZWYuZXhwbGljaXRGaWxlVHlwZTtcblxuICAgIC8vIEhhZCByZW1vdmVkIHRoZSB1c2Ugb2YgJ3Vua25vd24nLiAgSG93ZXZlciwgZm91bmQgdGhhdCB0ZXN0cyB3ZXJlIGRlbWFuZGluZyBpdC4gIFB1dCBiYWNrXG4gICAgLy8gIGluIGZvciBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgY2xpZW50cy4gXG4gICAgLy8gICAgdmFyIGZpbGV0eXBlID0gZmlsZVJlZi5sYXN0S25vd25GaWxlVHlwZSAmJiBmaWxlUmVmLmxhc3RLbm93bkZpbGVUeXBlICE9IERFRkFVTFRfRklMRVRZUEUgP1xuICAgIC8vICAgIGZpbGVSZWYubGFzdEtub3duRmlsZVR5cGUgOiBmaWxlUmVmLmV4cGxpY2l0RmlsZVR5cGU7XG5cbiAgICBmb3IgKHZhciBleHRlbnNpb24gaW4gRklMRVRZUEVfQllfRVhURU5TSU9OKSB7XG4gICAgICAgIGlmIChGSUxFVFlQRV9CWV9FWFRFTlNJT04uaGFzT3duUHJvcGVydHkodW5xdW90ZWQoZXh0ZW5zaW9uKSkpIHtcbiAgICAgICAgICAgIGlmIChGSUxFVFlQRV9CWV9FWFRFTlNJT05bdW5xdW90ZWQoZXh0ZW5zaW9uKV0gPT09IHVucXVvdGVkKGZpbGV0eXBlKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9uO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuXG5leHBvcnQgdHlwZSBYQ19FTkNPRElOR19UWVBFID0gNDtcbi8vY29uc3QgREVGQVVMVF9GSUxFRU5DT0RJTkc6IFhDX0VOQ09ESU5HX1RZUEUgPSA0OyAvLyB1bnVzZWQ/XG5cbmNvbnN0IEVOQ09ESU5HX0JZX0ZJTEVUWVBFOiB7IFtmaWxlVHlwZTogc3RyaW5nXTogWENfRU5DT0RJTkdfVFlQRSB9ID0ge1xuICAgICdzb3VyY2Vjb2RlLmMuaCc6IDQsXG4gICAgLy8gJ3NvdXJjZWNvZGUuYy5oJzogNCwgIGR1cGxpY2F0ZSBrZXkgcmVtb3ZlZFxuICAgICdzb3VyY2Vjb2RlLmMub2JqYyc6IDQsXG4gICAgJ3NvdXJjZWNvZGUuc3dpZnQnOiA0LFxuICAgICd0ZXh0JzogNCxcbiAgICAndGV4dC5wbGlzdC54bWwnOiA0LFxuICAgICd0ZXh0LnNjcmlwdC5zaCc6IDQsXG4gICAgJ3RleHQueGNjb25maWcnOiA0LFxuICAgICd0ZXh0LnBsaXN0LnN0cmluZ3MnOiA0XG59O1xuXG4vKipcbiAqIEBwYXJhbSBmaWxlUmVmIFxuICovXG5mdW5jdGlvbiBkZWZhdWx0RW5jb2RpbmcoZmlsZVJlZjogUGJ4RmlsZSk6IFhDX0VOQ09ESU5HX1RZUEUgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGZpbGV0eXBlOiBYQ19GSUxFVFlQRSB8ICd1bmtub3duJyB8IHVuZGVmaW5lZCA9IGZpbGVSZWYubGFzdEtub3duRmlsZVR5cGUgfHwgZmlsZVJlZi5leHBsaWNpdEZpbGVUeXBlO1xuXG4gICAgY29uc3QgZW5jb2RpbmcgPSBFTkNPRElOR19CWV9GSUxFVFlQRVt1bnF1b3RlZChmaWxldHlwZSldO1xuXG4gICAgaWYgKGVuY29kaW5nKSB7XG4gICAgICAgIHJldHVybiBlbmNvZGluZztcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbn1cblxuZXhwb3J0IHR5cGUgRklMRVRZUEVfR1JPVVAgPSAnRnJhbWV3b3JrcycgfCAnRW1iZWQgRnJhbWV3b3JrcycgfCAnUmVzb3VyY2VzJyB8ICdTb3VyY2VzJyB8XG4gICAgJ0NvcHkgRmlsZXMnICAvLyBBZGRlZCBDb3B5IEZpbGVzIHRvIHN1cHBvcnQgUEJYQ29weUZpbGVzQnVpbGRQaGFzZVxuICAgIDtcblxuY29uc3QgREVGQVVMVF9HUk9VUDogRklMRVRZUEVfR1JPVVAgPSAnUmVzb3VyY2VzJztcblxuY29uc3QgR1JPVVBfQllfRklMRVRZUEU6IHsgW2ZpbGVUeXBlOiBzdHJpbmddOiBGSUxFVFlQRV9HUk9VUCB9ID0ge1xuICAgICdhcmNoaXZlLmFyJzogJ0ZyYW1ld29ya3MnLFxuICAgICdjb21waWxlZC5tYWNoLW8uZHlsaWInOiAnRnJhbWV3b3JrcycsXG4gICAgJ3NvdXJjZWNvZGUudGV4dC1iYXNlZC1keWxpYi1kZWZpbml0aW9uJzogJ0ZyYW1ld29ya3MnLFxuICAgICd3cmFwcGVyLmZyYW1ld29yayc6ICdGcmFtZXdvcmtzJyxcbiAgICAnZW1iZWRkZWQuZnJhbWV3b3JrJzogJ0VtYmVkIEZyYW1ld29ya3MnLFxuICAgICdzb3VyY2Vjb2RlLmMuaCc6ICdSZXNvdXJjZXMnLFxuICAgICdzb3VyY2Vjb2RlLmMub2JqYyc6ICdTb3VyY2VzJyxcbiAgICAnc291cmNlY29kZS5zd2lmdCc6ICdTb3VyY2VzJ1xufTtcblxuZnVuY3Rpb24gZGV0ZWN0R3JvdXAoZmlsZVJlZjogUGJ4RmlsZSwgb3B0OiBJUGJ4RmlsZU9wdGlvbnMpOiBGSUxFVFlQRV9HUk9VUCB7XG5cbiAgICBpZiAob3B0LmN1c3RvbUZyYW1ld29yayAmJiBvcHQuZW1iZWQpIHtcbiAgICAgICAgcmV0dXJuIEdST1VQX0JZX0ZJTEVUWVBFWydlbWJlZGRlZC5mcmFtZXdvcmsnXSBhcyBGSUxFVFlQRV9HUk9VUDtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb24gPSBwYXRoLmV4dG5hbWUoZmlsZVJlZi5iYXNlbmFtZSkuc3Vic3RyaW5nKDEpO1xuXG4gICAgaWYgKGV4dGVuc2lvbiA9PT0gJ3hjZGF0YW1vZGVsZCcpIHtcbiAgICAgICAgcmV0dXJuICdTb3VyY2VzJztcbiAgICB9XG5cbiAgICBjb25zdCBmaWxldHlwZSA9IGZpbGVSZWYubGFzdEtub3duRmlsZVR5cGUgfHwgZmlsZVJlZi5leHBsaWNpdEZpbGVUeXBlO1xuICAgIGNvbnN0IGdyb3VwTmFtZSA9IEdST1VQX0JZX0ZJTEVUWVBFW3VucXVvdGVkKGZpbGV0eXBlKV07XG5cbiAgICByZXR1cm4gZ3JvdXBOYW1lID8gZ3JvdXBOYW1lIDogREVGQVVMVF9HUk9VUDtcbn1cblxuLy8gIEFkZCBvdGhlciB0eXBlcyBoZXJlIG9yIGp1c3QgYXBwZW5kIHN0cmluZyBpZiBuZWNlc3NhcnkuXG5leHBvcnQgdHlwZSBYQ19TT1VSQ0VUUkVFID0gJ1NES1JPT1QnIHwgJ1wiPGdyb3VwPlwiJyB8ICdCVUlMVF9QUk9EVUNUU19ESVInIHwgJ1wiYWJzb2x1dGVcIicgfCAnU09VUkNFX1JPT1QnO1xuXG5jb25zdCBTT1VSQ0VUUkVFX0JZX0ZJTEVUWVBFOiB7IFtmaWxlVHlwZTogc3RyaW5nXTogWENfU09VUkNFVFJFRSB9ID0ge1xuICAgICdjb21waWxlZC5tYWNoLW8uZHlsaWInOiAnU0RLUk9PVCcsXG4gICAgJ3NvdXJjZWNvZGUudGV4dC1iYXNlZC1keWxpYi1kZWZpbml0aW9uJzogJ1NES1JPT1QnLFxuICAgICd3cmFwcGVyLmZyYW1ld29yayc6ICdTREtST09UJ1xufTtcblxuY29uc3QgREVGQVVMVF9TT1VSQ0VUUkVFOiBYQ19TT1VSQ0VUUkVFID0gJ1wiPGdyb3VwPlwiJztcbmNvbnN0IERFRkFVTFRfUFJPRFVDVF9TT1VSQ0VUUkVFOiBYQ19TT1VSQ0VUUkVFID0gJ0JVSUxUX1BST0RVQ1RTX0RJUic7XG5cbmZ1bmN0aW9uIGRldGVjdFNvdXJjZXRyZWUoZmlsZVJlZjogUGJ4RmlsZSk6IFhDX1NPVVJDRVRSRUUge1xuXG4gICAgdmFyIGZpbGV0eXBlID0gZmlsZVJlZi5sYXN0S25vd25GaWxlVHlwZSB8fCBmaWxlUmVmLmV4cGxpY2l0RmlsZVR5cGUsXG4gICAgICAgIHNvdXJjZXRyZWUgPSBTT1VSQ0VUUkVFX0JZX0ZJTEVUWVBFW3VucXVvdGVkKGZpbGV0eXBlKV07XG5cbiAgICBpZiAoZmlsZVJlZi5leHBsaWNpdEZpbGVUeXBlKSB7XG4gICAgICAgIHJldHVybiBERUZBVUxUX1BST0RVQ1RfU09VUkNFVFJFRTtcbiAgICB9XG5cbiAgICBpZiAoZmlsZVJlZi5jdXN0b21GcmFtZXdvcmspIHtcbiAgICAgICAgcmV0dXJuIERFRkFVTFRfU09VUkNFVFJFRTtcbiAgICB9XG5cbiAgICBpZiAoIXNvdXJjZXRyZWUpIHtcbiAgICAgICAgcmV0dXJuIERFRkFVTFRfU09VUkNFVFJFRTtcbiAgICB9XG5cbiAgICByZXR1cm4gc291cmNldHJlZTtcbn1cblxuZXhwb3J0IHR5cGUgRklMRVRZUEVfUEFUSFMgPSAndXNyL2xpYi8nIHwgJ1N5c3RlbS9MaWJyYXJ5L0ZyYW1ld29ya3MvJztcblxuY29uc3QgUEFUSF9CWV9GSUxFVFlQRTogeyBbZmlsZVR5cGU6IHN0cmluZ106IEZJTEVUWVBFX1BBVEhTIH0gPSB7XG4gICAgJ2NvbXBpbGVkLm1hY2gtby5keWxpYic6ICd1c3IvbGliLycsXG4gICAgJ3NvdXJjZWNvZGUudGV4dC1iYXNlZC1keWxpYi1kZWZpbml0aW9uJzogJ3Vzci9saWIvJyxcbiAgICAnd3JhcHBlci5mcmFtZXdvcmsnOiAnU3lzdGVtL0xpYnJhcnkvRnJhbWV3b3Jrcy8nXG59O1xuXG5cbmZ1bmN0aW9uIGRlZmF1bHRQYXRoKGZpbGVSZWY6IFBieEZpbGUsIGZpbGVQYXRoOiBzdHJpbmcpOiBGSUxFVFlQRV9QQVRIUyB8IHN0cmluZyB7XG5cbiAgICBpZiAoZmlsZVJlZi5jdXN0b21GcmFtZXdvcmspIHtcbiAgICAgICAgcmV0dXJuIGZpbGVQYXRoO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbGV0eXBlID0gZmlsZVJlZi5sYXN0S25vd25GaWxlVHlwZSB8fCBmaWxlUmVmLmV4cGxpY2l0RmlsZVR5cGU7XG4gICAgY29uc3QgZGVmYXVsdFBhdGggPSBQQVRIX0JZX0ZJTEVUWVBFW3VucXVvdGVkKGZpbGV0eXBlKV07XG5cbiAgICBpZiAoZGVmYXVsdFBhdGgpIHtcbiAgICAgICAgcmV0dXJuIHBhdGguam9pbihkZWZhdWx0UGF0aCwgcGF0aC5iYXNlbmFtZShmaWxlUGF0aCkpO1xuICAgIH1cblxuICAgIHJldHVybiBmaWxlUGF0aDtcbn1cblxuLy8gdW51c2VkPyAtLSBqdXN0IHJldHVybmVkIGl0c2VsZi5cbi8vIGZ1bmN0aW9uIGRlZmF1bHRHcm91cChmaWxlUmVmOlBieEZpbGUpOkZJTEVUWVBFX0dST1VQIHtcbi8vICAgICB2YXIgZ3JvdXBOYW1lID0gR1JPVVBfQllfRklMRVRZUEVbZmlsZVJlZi5sYXN0S25vd25GaWxlVHlwZV07XG5cbi8vICAgICBpZiAoIWdyb3VwTmFtZSkge1xuLy8gICAgICAgICByZXR1cm4gREVGQVVMVF9HUk9VUDtcbi8vICAgICB9XG5cbi8vICAgICByZXR1cm4gZGVmYXVsdEdyb3VwO1xuLy8gfVxuLyoqIE9wdGlvbnMgcGFzc2VkIGluIHdoZW4gY3JlYXRpbmcgYSBQQlhGaWxlIG9iamVjdCAqL1xuZXhwb3J0IGludGVyZmFjZSBJUGJ4RmlsZU9wdGlvbnMge1xuXG4gICAgY3VzdG9tRnJhbWV3b3JrPzogYm9vbGVhbjtcblxuICAgIC8vICBJZiBlbWJlZCBhbmQgc2lnbiBhcmUgYm90aCB0cnVlLCBhZGRzIEFUVFJJQlVURVMgJ0NvZGVTaWduT25Db3B5J1xuICAgIGVtYmVkPzogYm9vbGVhbjtcbiAgICBzaWduPzogYm9vbGVhbjtcbiAgICBkZWZhdWx0RW5jb2Rpbmc/OiBYQ19FTkNPRElOR19UWVBFO1xuICAgIGxhc3RLbm93bkZpbGVUeXBlPzogWENfRklMRVRZUEUgfCBudWxsO1xuICAgIGV4cGxpY2l0RmlsZVR5cGU/OiBYQ19GSUxFVFlQRTtcbiAgICBzb3VyY2VUcmVlPzogWENfU09VUkNFVFJFRTtcbiAgICBjb21waWxlckZsYWdzPzogc3RyaW5nO1xuXG4gICAgLy8gIFNldHMgdGhlIHN0dGluZ3MgQVRUUklCVVRFUyAnV2VhaydcbiAgICB3ZWFrPzogYm9vbGVhbjtcblxuICAgIC8vICBJbXBsZW1lbnRhdGlvbiBOb3RlOiAgVGhpcyBwcm9wZXJ0eSBpcyBzZXQgb24gbmV3bHlcbiAgICAvLyAgY3JlYXRlZCBQYnhGaWxlcyBpbiBtdWx0aXBsZSBwbGFjZXMgYnV0IG5vdCBpbiB0aGVcbiAgICAvLyAgY29uc3RydWN0b3IuICBXaHk/ICBJcyBpdCB0aGUgY2FzZSB0aGF0IHNvbWUgcGxhY2VzXG4gICAgLy8gIHNob3VsZCBub3Qgc2V0IGl0PyAgXG4gICAgLy8gIEludmVzdGlnYXRpb246ICBUT0RPXG4gICAgLy8gIENoYW5naW5nIHRoaXMgYWZ0ZXIgY2xpZW50cyBhcmUgdXNpbmcgaXQgY291bGQgaGF2ZSBhZHZlcnNlXG4gICAgLy8gIGFmZmVjdHMuXG4gICAgdGFyZ2V0Pzogc3RyaW5nOyAvLyBhc3N1bWVkIHN0cmluZ1xuXG4gICAgLy8gIFRoZSBzZXR0aW5ncyBiZWxvdyBhcmUgbm90IHVzZWQgYnkgUGJ4RmlsZSBhbmQgc2hvdWxkXG4gICAgLy8gIG5vdCBiZSBwYXJ0IG9mIHRoaXMgaW50ZXJmYWNlIGFzIGl0IGlzIGNvbmZ1c2luZy4gTW92ZSB0aGVtXG4gICAgLy8gIGludG8gdGhlICYgd2l0aCB0aGUgaW50ZXJmYWNlLlxuICAgIC8vIHBsdWdpbj86IGJvb2xlYW47XG4gICAgLy8gIEFwcGxpY2FibGUgdG8gYSBQcm9kdWN0RmlsZSwgbm90IGEgcGx1Z2luIGZpbGVcbiAgICAvLyAgZ3JvdXA/OiBGSUxFVFlQRV9HUk9VUDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJUGJ4RmlsZVNldHRpbmdzIHtcbiAgICBBVFRSSUJVVEVTPzogc3RyaW5nW107XG4gICAgQ09NUElMRVJfRkxBR1M/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUxvbmdDb21tZW50T2JqIHtcbiAgICBiYXNlbmFtZTogc3RyaW5nLFxuICAgIGdyb3VwPzogRklMRVRZUEVfR1JPVVBcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJRmlsZVBhdGhPYmogZXh0ZW5kcyBJTG9uZ0NvbW1lbnRPYmoge1xuICAgIHV1aWQ/OiBzdHJpbmcsXG4gICAgZmlsZVJlZj86IFhDX1BST0pfVVVJRFxuXG4gICAgc2V0dGluZ3M/OiBJUGJ4RmlsZVNldHRpbmdzO1xufVxuXG5cbi8qKiBJbiBtZW1vcnkgaW5zdGFuY2UgZm9yIGludGVyYWN0aW5nIHdpdGggYSBjb25jZXB0dWFsIFBieEZpbGUuXG4gKiBUaGlzIGlzIG5vdCBwYXJ0IG9mIHRoZSBpbiBtZW1vcnkgbW9kZWwgb2YgdGhlIGZpbGUgY29udGVudHMuICBcbiAqIFRoaXMgaXMgdHVybmVkIGludG8gYSBQQlhGaWxlUmVmZXJlbmNlIGJ5IHRoZSBub24gZXhwb3NlZCBmdW5jdGlvbiBcbiAqIHBieEZpbGVSZWZlcmVuY2VPYmogdXNlZCBieSB0aGUgbWV0aG9kcyBhZGRUb1BieEZpbGVSZWZlcmVuY2VTZWN0aW9uIGFuZCBcbiAqIHJlbW92ZUZyb21QYnhGaWxlUmVmZXJlbmVTZWN0aW9uLlxuICAqL1xuZXhwb3J0IGNsYXNzIFBieEZpbGUgaW1wbGVtZW50cyBJRmlsZVBhdGhPYmoge1xuXG4gICAgYmFzZW5hbWU6IHN0cmluZztcblxuICAgIC8qKiBUaGlzIGlzIGEgdmFsdWUgZnJvbSB0aGUgZGljdGlvbmFyeSBGSUxFVFlQRV9CWV9FWFRFTlNJT05cbiAgICAgKiB3aXRoaW4gcGJ4RmlsZS5qcyBvciAndW5rbm93bidcbiAgICAgKi9cbiAgICBsYXN0S25vd25GaWxlVHlwZT86IFhDX0ZJTEVUWVBFIHwgJ3Vua25vd24nO1xuICAgIC8vbGFzdEtub3duRmlsZVR5cGU/OiBYQ19GSUxFVFlQRTsgIFxuICAgIC8vICBXb3VsZCBwcmVmZXIgdG8gaGF2ZSB1bmtub3duIG9yIG51bGwgaWYgaXQgaXMgdW5rbm93bi4gIFxuICAgIC8vICAgICAgQlVULCB0aGUgZXhpc3RpbmcgY29kZSBkZW1hbmRzICd1bmtvd24nXG5cbiAgICAvLyAgQXNzdW1pbmcgdGhpcyBtdXN0IGJlIGEga25vd24gZmlsZSB0eXBlXG4gICAgZXhwbGljaXRGaWxlVHlwZT86IFhDX0ZJTEVUWVBFO1xuXG4gICAgLyoqXG4gICAgICogRWl0aGVyOlxuICAgICAqIDEpICdTb3VyY2VzJ1xuICAgICAqIDIpIEEgdmFsdWUgaW4gdGhlIEdST1VQX0JZX0ZJTEVUWVBFIGRpY3Rpb25hcnlcbiAgICAgKiAzKSBGYWxscyBiYWNrIHRvICdSZXNvdXJjZXMnICBpLmUuIERFRkFVTFRfR1JPVVBcbiAgICAgKi9cbiAgICBncm91cD86IEZJTEVUWVBFX0dST1VQO1xuXG4gICAgLyoqIHRydWUgaWYgb3B0IGlzIHNldCB3aXRoIGN1c3RvbUZyYW1ld29yayBzZXQgdG8gdHJ1ZSAqL1xuICAgIGN1c3RvbUZyYW1ld29yaz86IGJvb2xlYW47XG5cbiAgICBkaXJuYW1lPzogc3RyaW5nO1xuICAgIHBhdGg6IHN0cmluZztcbiAgICAvKiogRWl0aGVyIG9wdGlvbi5kZWZhdWx0RW5jb2Rpbmcgb3IgYSB2YWx1ZSBmcm9tIEVOQ09ESU5HX0JZX0ZJTEVUWVBFICovXG4gICAgZGVmYXVsdEVuY29kaW5nPzogWENfRU5DT0RJTkdfVFlQRTtcbiAgICBmaWxlRW5jb2Rpbmc/OiBYQ19FTkNPRElOR19UWVBFO1xuXG4gICAgc291cmNlVHJlZTogWENfU09VUkNFVFJFRTtcblxuICAgIGluY2x1ZGVJbkluZGV4OiBudW1iZXI7XG5cbiAgICBzZXR0aW5ncz86IElQYnhGaWxlU2V0dGluZ3M7XG5cblxuICAgIC8qKiBBcHBsaWNhYmxlIHRvIHByb2R1Y3QgZmlsZXMsIG5vdCBwbHVnaW5zICovXG4gICAgdGFyZ2V0PzogWENfUFJPSl9VVUlEOyAvLyBBc3N1bWVkIHN0cmluZ1xuXG5cbiAgICBmaWxlUmVmPzogWENfUFJPSl9VVUlEO1xuICAgIC8qKiBTZXQgd2hlbiBhZGRpbmcgdGhlIHBsdWdpbiwgbm90IHN1cmUgaWYgbG9hZGluZyBmcm9tIGRpc2suXG4gICAgICogQWxsIHBsdWdpbnMgYXJlIHBsYWNlZCBpbiB0aGUgc2FtZSBzdWJmb2xkZXIuXG4gICAgICovXG4gICAgcGx1Z2luPzogYm9vbGVhbjtcblxuICAgIHV1aWQ/OiBYQ19QUk9KX1VVSUQ7XG5cblxuICAgIGNvbnN0cnVjdG9yKGZpbGVwYXRoOiBzdHJpbmcsIG9wdD86IElQYnhGaWxlT3B0aW9ucyB8IG51bGwpIHtcbiAgICAgICAgY29uc3QgZWZPcHQ6IElQYnhGaWxlT3B0aW9ucyA9IG9wdCB8fCB7fTtcblxuICAgICAgICB0aGlzLmJhc2VuYW1lID0gcGF0aC5iYXNlbmFtZShmaWxlcGF0aCk7XG4gICAgICAgIHRoaXMubGFzdEtub3duRmlsZVR5cGUgPSBlZk9wdC5sYXN0S25vd25GaWxlVHlwZSB8fCBkZXRlY3RUeXBlKGZpbGVwYXRoKTtcbiAgICAgICAgdGhpcy5ncm91cCA9IGRldGVjdEdyb3VwKHRoaXMsIGVmT3B0KTtcblxuICAgICAgICAvLyBmb3IgY3VzdG9tIGZyYW1ld29ya3NcbiAgICAgICAgaWYgKGVmT3B0LmN1c3RvbUZyYW1ld29yayA9PSB0cnVlKSB7XG4gICAgICAgICAgICB0aGlzLmN1c3RvbUZyYW1ld29yayA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmRpcm5hbWUgPSBwYXRoLmRpcm5hbWUoZmlsZXBhdGgpLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGF0aCA9IGRlZmF1bHRQYXRoKHRoaXMsIGZpbGVwYXRoKS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG4gICAgICAgIHRoaXMuZmlsZUVuY29kaW5nID0gdGhpcy5kZWZhdWx0RW5jb2RpbmcgPSBlZk9wdC5kZWZhdWx0RW5jb2RpbmcgfHwgZGVmYXVsdEVuY29kaW5nKHRoaXMpO1xuXG4gICAgICAgIC8vIFdoZW4gcmVmZXJlbmNpbmcgcHJvZHVjdHMgLyBidWlsZCBvdXRwdXQgZmlsZXNcbiAgICAgICAgaWYgKGVmT3B0LmV4cGxpY2l0RmlsZVR5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuZXhwbGljaXRGaWxlVHlwZSA9IGVmT3B0LmV4cGxpY2l0RmlsZVR5cGU7XG4gICAgICAgICAgICB0aGlzLmJhc2VuYW1lID0gdGhpcy5iYXNlbmFtZSArICcuJyArIGRlZmF1bHRFeHRlbnNpb24odGhpcyk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5wYXRoO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMubGFzdEtub3duRmlsZVR5cGU7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5ncm91cDtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmRlZmF1bHRFbmNvZGluZztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc291cmNlVHJlZSA9IGVmT3B0LnNvdXJjZVRyZWUgfHwgZGV0ZWN0U291cmNldHJlZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pbmNsdWRlSW5JbmRleCA9IDA7XG5cbiAgICAgICAgaWYgKGVmT3B0LndlYWsgJiYgZWZPcHQud2VhayA9PT0gdHJ1ZSlcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MgPSB7IEFUVFJJQlVURVM6IFsnV2VhayddIH07XG5cbiAgICAgICAgaWYgKGVmT3B0LmNvbXBpbGVyRmxhZ3MpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5zZXR0aW5ncylcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzID0ge307XG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzLkNPTVBJTEVSX0ZMQUdTID0gdXRpbC5mb3JtYXQoJ1wiJXNcIicsIGVmT3B0LmNvbXBpbGVyRmxhZ3MpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVmT3B0LmVtYmVkICYmIGVmT3B0LnNpZ24pIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5zZXR0aW5ncylcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzID0ge307XG4gICAgICAgICAgICBpZiAoIXRoaXMuc2V0dGluZ3MuQVRUUklCVVRFUylcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLkFUVFJJQlVURVMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuQVRUUklCVVRFUy5wdXNoKCdDb2RlU2lnbk9uQ29weScpO1xuICAgICAgICB9XG4gICAgfVxufSJdfQ==